---
title: "Problem Sheet 1"
output: pdf_document
date: "2024-10-08"
---
# Task 1 : Hypothesis
## Import data
```{r}
setwd("/Users/carlaleone/Desktop/Exeter/Problem Sheet")
data <- read.table("BIOM4025_data_2024.csv", header=TRUE, sep = ",", 
                      stringsAsFactors = FALSE)
View(data)
```

## Hypothesis:
We want to know whether morning routine affects the amount that an individual exercises. Average daily commute, wake up time, in terms of hours after midnight, and whether an individual has breakfast are not are the factors describing morning routine. 
We expect individuals to exercise more if they wake up earlier, have breakfast, and have a shorter average commute time. 


# Task 2: Model

1. Adjust columns to make them the appropriate units and classes.
```{r}
# add other columns
data$avg.commute<- (data$Commute.today + data$Commute.yesterday)/ 2 #average commute of individual
class(data$Waking.up.time) #character class, so need to convert it to numeric
data$wakeup<- as.POSIXct(paste("2024-01-01", data$Waking.up.time), format = "%Y-%m-%d %H:%M") #convert character to date and time format
data$hours.midnight<-  as.numeric(format(data$wakeup, "%H")) + as.numeric(format(data$wakeup, "%M")) / 60 #convert date and time to numeric
# are there any missing values?
is.na(data$avg.commute)
data <- data[!is.na(data$avg.commute),] #remove na from average commute column
View(data)
```


2. Explore variables + Check for correlations or interactions in the predictors:
```{r}
# Plot Exercise against wake up time
plot(data$Exercise~data$Hours.Slept)
# No obvious relationship, could be a slightly negative relationship. 
```


```{r}
# Plot Exercise against average commute
plot(data$Exercise~data$avg.commute)
# Again,no obvious relationships from the data, but could be leaning towards a positive slope.
```


```{r}
#Check if continuous variables are correlated
cor.test(data$Hours.Slept,data$avg.commute) 
#not correlated
#p = 0.5643, cor = -0.06157292 
```


```{r}
#Is there a potential relationship between the categorical and continuous predictors?
print(aggregate(data$Hours.Slept, by=list(data$Breakfast), mean, na.rm =T))
```


```{r}
# Visualize the table with a box plot
boxplot(Hours.Slept~Breakfast, data=data)
#Seems like people who eat breakfast sleep longer.
```


```{r}
hist(data$Exercise)
# The response is not normal, but it is count data so should be modeled in a poisson distribution
```

3. Create the model

- Creating a model with Breakfast as an interaction term with time of wake up.
```{r}
m.i<- glm(Exercise~Hours.Slept*Breakfast + avg.commute, data = data, family = poisson)
summary(m.i)
#AIC = 378.45 and the interaction term is not significant
# No overdispersion, Residual deviance < Residual Degrees of Freedom

```

```{r}
anova(m.i,test="Chisq")
# Avg commute is the least significant term, so in the next model can remove it.
```

```{r}
m.i.2<- glm(Exercise~Hours.Slept*Breakfast , data = data, family = poisson)
summary(m.i.2)
# AIC = 376.55
# No overdispersion, Residual deviance < Degrees of Freedom
```
Neither of the models are overdispersed, however, the model with the interaction term does not have a significant interaction, has a higher AIC, and fewer degrees of freedom. It is likely that having breakfast is not significant when other variables are used as predictors, despite a difference indicated by the earlier box plot.  Therefore, we will use the model without the interaction.

```{r}
m<- glm(Exercise~Hours.Slept+Breakfast , data = data, family = poisson)
summary(m)
#AIC = 376.23
anova(m, test= "Chisq")
```

Check if we can further simplify the model. 
```{r}
m2<- glm(Exercise~Breakfast , data = data, family = poisson)
summary(m2) 
#AIC = 375.57
anova(m2, test= "Chisq")
#breakfast is more significant when hours slept is still included in the model. 
#Therefore we will use m as our final model.
```
The model with only breakfast has a lower AIC, but it makes Breakfast less significant. Therefore, we will keep the original model with both Breakfast and Hours slept.


- Checking diagnostic plots
```{r}
par(mfrow=c(2,2))
plot(m)
# The residuals seem normally distributed (QQ Plot), with a little deviance and there is a little bit of bunching but generally the variances seem scattered and show no pattern. 
```

The diagnostic plots look ok, they are not perfect, but it is still possible to move on with the model. So this is our final model:
`glm(Exercise~Hours.Slept+Breakfast , data = data, family = poisson)`





```{r}

exercise_fitted<- predict(model1)
plot(Exercise ~ n_siblings, data, cex.lab=1.2, col="grey", font.lab=2, pch=19, 
     xlab="Number of Siblings", ylab="Exercise")
lines(exercise_fitted[order(data$Exercise)] ~ sort(data$Exercise))
```

# Task 3: Results

```{r}
b0 <- m$coefficients[1] # intercept
b1 <- m$coefficients[2] # hours slept
b2 <- m$coefficients[3] # breakfast

predicted <- predict(m, type='response') 
predicted.Y <- predicted[data$Breakfast=="Yes"] 
predicted.N <- predicted[data$Breakfast=="No"]

logit.m.predicted <- b0 + b1*data$Hours.Slept
predicted.2 <- 1/(1+exp(-logit.psr.predicted))
```


# Task 4
```{r}
plot(Exercise ~ Hours.Slept, data=data, pch=NA, xlab="Hours of Sleep", ylab="Exercise")
points(Exercise ~ Hours.Slept, data=data[data$Breakfast=="Yes", ], pch=19, col="grey70") 
points(Exercise ~ Hours.Slept, data=data[data$Breakfast=="No", ], pch=19, col="grey30")
lines(predicted.Y[order(data$Exercise[data$Breakfast=="Yes"])] ~ sort(data$Exercise[data$Breakfast=="Yes"]), lwd=1.5, col="grey70")
lines(predicted.N[order(data$Exercise[data$Breakfast=="No"])] ~ sort(data$Exercise[data$Breakfast=="No"]), lwd=1.5, col="grey30")
legend(x="topleft", legend=c("Yes", "No"), pch=19,
col=c("grey30", "grey70"), lwd=c(1,1), title="Eats Breakfast", cex=0.8)
```
```{r}
plot(Exercise~Hours.Slept, data=data)
lines(predicted[order(Hours.Slept)] ~sort(Hours.Slept), data = data[data$Breakfast == "Yes",])
lines(predicted[order(Hours.Slept)] ~sort(Hours.Slept), data = data[data$Breakfast == "No",])
```


Figures
```{r}
plot(hours.midnight ~ n.siblings, data=data, pch=NA, xlab="Number of Siblings", ylab="Hours after midnight")
points(hours.midnight ~ n.siblings, data=data[data$Breakfast=="Yes", ], pch=19, col="grey70") 
points(hours.midnight ~ n.siblings, data=data[data$Breakfast=="No", ], pch=19, col="grey30")
lines(psr.predicted[order(data$)] ~ sort(t.data$log.fam))
legend(x="topleft", legend=c("D", "S"), pch=19, lty = 1, col=c("grey30", "grey70"), title="social status", cex=0.7)
```

