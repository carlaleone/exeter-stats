---
title: "Problem Sheet 1"
output: pdf_document
date: "2024-10-08"
---
# Task 1 : Hypothesis
## Import data
```{r}
setwd("/Users/carlaleone/Desktop/Exeter/Problem Sheet")
data <- read.table("BIOM4025_data_2024.csv", header=TRUE, sep = ",", 
                      stringsAsFactors = FALSE)
View(data)
```

## Hypothesis:
We want to know whether morning routine affects the amount that an individual exercises:
Does height have an effect on the amount of exercise that an individual does, and does having siblings affect this relationship?

We expect individuals to exercise more if they wake up earlier, have breakfast, and have a shorter average commute time. 



## Explore data
```{r}
# if we want to use height, need to convert it into cm 
height_to_cm <- function(height) {
  sapply(height, function(h) {
    if (grepl("cm", h)) { # If the value is already in cm convert it to numeric format
      as.numeric(gsub("cm", "", h))
    } else if (grepl("m",h)) {
      m<- as.numeric(gsub("m.*", "", h))
      (m*100)
    } # convert the values that are in m
    else if (grepl("ft", h)) {
      # If the value is in feet and inches
      ft <- as.numeric(gsub("ft.*", "", h)) # identify ft
      in_val <- as.numeric(gsub(".*ft |in", "", h)) # identify in
      (ft * 30.48) + (in_val * 2.54) # Convert ft and in to cm
    } else {
      NA 
    }
  })
}

data$new.height<- height_to_cm(data$Height)
hist(data$new.height)

# add other columns
data$age<- 2024 -  data$Year.of.birth # age of individual
data$avg.commute<- (data$Commute.today + data$Commute.yesterday)/ 2 #average commute of individual
data$siblings<- ifelse(data$Brothers > 0 | data$Sisters > 0, "Yes", "No") # does the individual have siblings?
data$n.siblings<- as.numeric(data$Brothers + data$Sisters) #how many siblings?
data <- data[data$Gender != "Other",]
View(data)
class(data$Waking.up.time) #character class, so need to convert it to numeric
data$wakeup<- as.POSIXct(paste("2024-01-01", data$Waking.up.time), format = "%Y-%m-%d %H:%M") #convert character to date and time format
data$hours.midnight<-  as.numeric(format(data$wakeup, "%H")) + as.numeric(format(data$wakeup, "%M")) / 60 #convert date and time to numeric

hist(data$Exercise)
#skewed data and similar to poisson because the exercise is count data. Will use a glm.
```

Explore variables + Check for correlations or interactions in the predictors:
```{r}
plot(data$Exercise~data$hours.midnight)
plot(data$Exercise~data$avg.commute)
# no obvious relationships from the data. 

#check if continuous variables are correlated
cor.test(data$hours.midnight,data$avg.commute) #not correlated, p = 0.5142, cor = -0.07006104

#Is there a potential relstionship between the categorical and continuous predictors?
aggregate(data$hours.midnight, by=list(data$Breakfast), mean, na.rm =T)
boxplot(hours.midnight~Breakfast, data=data)
#seems like people who don't eat breakfast wake up later.
hist(data$Exercise)
#treating as count data -> will need to be poisson

```

First model using all predictors
```{r}
newests<- lm(hours.midnight~mc.siblings*Breakfast, data=data, na.values=T)
plot(data$hours.midnight~data$mc.siblings)

hist(data$hours.midnight)
qqnorm(resid(newest))
qqline(resid(newest))
# Residuals look normal


```

Check if continuous predictors are correlated.
```{r}
cor.test(data$hours.midnight,data$avg.commute) #not correlated
```


Create the model
```{r}
glm1<- glm(Exercise~hours.midnight*Breakfast + avg.commute, data = data, family = poisson)
glm2<- glm(Exercise~hours.midnight+ Breakfast + avg.commute, data = data, family = poisson)
summary(glm2)
anova(glm2,test = "Chisq" )
#avg commute is the least significant variable, so can be removed from the model. 
plot(glm2)
drop1(glm1, test = "Chisq")
qqnorm(resid(glm2))
qqline(resid(glm2))
```


```{r}
plot(lm1)
shapiro.test(resid(lm1))
```


```{r}
hist(log(data$Exercise))
hist(data$bc.exercise)

plot(data$Exercise~data$avg.commute)

lm2<- lm(Exercise ~ log(new.height)*Breakfast, data = data) #includes sibling interaction
summary(lm2)
lm3<- lm(Exercise~ prop.brothers, data =data)
summary(lm3)
anova(lm1,lm2) # there is not really a significant difference between the models
AIC(lm1, lm2)

hist(data$Exercise)
plot(lm2)
# plots all look very good in terms of normality of residuals and heteroscedasticity. 
```


```{r}
# BOXCOX Transforation
library(MASS)
bc <- boxcox(lm(data$Exercise ~ 1), plotit = FALSE)
lambda <- bc$x[which.max(bc$y)]
lambda
#0.3 
data$bc.exercise <- (data$Exercise^lambda - 1) / lambda # APPLY this transformation using lambda to each number of fam

hist(data$new.height)
# plot
par(mfrow=c(1,2))
hist(data$bc.exercise)
qqnorm(data$bc.exercise)
qqline(data$bc.exercise)
```


# Task 2

Modelling. 

```{r}
model1<- glm(Exercise ~ n.siblings*Breakfast,family=poisson, data = data)
summary(model1)

model2<- glm(Exercise ~ n.siblings+ Breakfast,family=poisson, data = data)
summary(model2)


model3<- glm(Exercise ~ new.height*siblings, data=data, family =poisson)
summary(model3)
plot(model3)

exercise_fitted<- predict(model1)
plot(Exercise ~ n_siblings, data, cex.lab=1.2, col="grey", font.lab=2, pch=19, 
     xlab="Number of Siblings", ylab="Exercise")
lines(exercise_fitted[order(data$Exercise)] ~ sort(data$Exercise))
```

```{r}
par(mfrow=c(2,2))
plot(model1)
```


# Task 3

Results.

# Task 4

Figures
```{r}
plot(hours.midnight ~ n.siblings, data=data, pch=NA, xlab="Number of Siblings", ylab="Hours after midnight")
points(hours.midnight ~ n.siblings, data=data[data$Breakfast=="Yes", ], pch=19, col="grey70") 
points(hours.midnight ~ n.siblings, data=data[data$Breakfast=="No", ], pch=19, col="grey30")
lines(psr.predicted[order(data$)] ~ sort(t.data$log.fam))
legend(x="topleft", legend=c("D", "S"), pch=19, lty = 1, col=c("grey30", "grey70"), title="social status", cex=0.7)
```

